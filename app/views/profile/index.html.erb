<div id="avatar" class="avatar_portal">
  <img id="body" class="avatar">
  <img id="shoes" class="avatar">
  <img id="bottom" class="avatar">
  <img id="top" class="avatar">
  <img id="hair" class="avatar">
  <img id="head" class="avatar">
</div>

<div id="controls" class="avatar_stats">
  <input id="full_name" name="full_name" class="input">
</div>

<div id="show_controls" class="avatar_controls">
  <input id="modify" name="modify" type="button" class="clickable button" value="MODIFY">
</div>

<div id="edit_controls" class="avatar_controls">
  <input id="save" name="modify" type="button" class="clickable button" value="SAVE">
</div>

<div id="wardrobe_options" class="wardrobe_options">
  <div id="wardrobe_categories" class="wardrobe_categories">
    <div id="category_head" class="wardrobe_item clickable" value="head">Head</div>
    <div id="category_body" class="wardrobe_item clickable" value="body">Body</div>
    <div id="category_legs" class="wardrobe_item clickable" value="legs">Legs</div>
    <div id="category_feet" class="wardrobe_item clickable" value="feet">Feet</div>
    <div id="category_misc" class="wardrobe_item clickable" value="misc">Misc</div>
  </div>

  <div id="wardrobe_subcategories" class="wardrobe_subcategories">
    <div id="subcategory_0" class="wardrobe_item clickable"></div>
    <div id="subcategory_1" class="wardrobe_item clickable"></div>
    <div id="subcategory_2" class="wardrobe_item clickable"></div>
    <div id="subcategory_3" class="wardrobe_item clickable"></div>
    <div id="subcategory_4" class="wardrobe_item clickable"></div>
  </div>
</div>

<script type="text/javascript">
<!--

var _wardrobeItems;
var _profile;
var _avatar;

$(window).load(function() {
  if ($("#full_name").val() == "") {
    $("#full_name").attr("readonly", "true");
    $("#full_name").val("Enter Full Name");
    $("#edit_controls").hide();
    $("#wardrobe_options").hide();
    $("#wardrobe_subcategories").hide();
  }
  
  // CUSTOMIZE AVATAR
  $("#modify").click(function() {
    if (_wardrobeItems == undefined) {
      // Fillup the wardrobe for the first time
      $.getJSON("/profile/edit", { },
         function(data){
           for (i=0; i<data.length; i++) {
             if (data[i].depth == 0) {
               $("#category_"+data[i].item_type).attr("value", data[i].id)
             }
           }
           _wardrobeItems = data;
         });  
    }

    $("#show_controls").hide();
    $("#edit_controls").show();
    $("#wardrobe_options").show();
    $("#full_name").removeAttr("readonly");
  })

  // SAVE AVATAR
  $("#save").click(function() {
    $.getJSON("/profile/save", { id: _profile.id, profile: _profile, avatar: _avatar },
       function(data){
         _profile = data.profile;
         _avatar = data.avatar;
         
         $("#show_controls").show();
         $("#edit_controls").hide();
         $("#wardrobe_options").hide();
         $("#full_name").attr("readonly", "true");
       });
  })

  // Finish editing a field
  $(".input").blur(function() {
    _profile.full_name = $("#full_name").val();
  });
  
  $(".wardrobe_item").click(function() {
    image_file = $(this).attr("image_file");
    if (image_file != undefined) {
      // Display the item on the avatar
      item_type = $(this).attr("item_type");
      $("#"+item_type).attr("src", "/assets/wardrobe/"+image_file);
      _avatar[item_type] = image_file
    } else {
      id = $(this).attr("value");
      resetSubCategory();
      showSubCategory(id);
      $("#wardrobe_subcategories").show();
    }
  });
  
  $.getJSON("/profile/show", { },
     function(data){
       _profile = data.profile;
       _avatar = data.avatar;
       showAvatar();
     });  
});

function resetSubCategory() {
  for (i=0; i<5; i++) {
    $("#subcategory_"+i).html("");
    $("#subcategory_"+i).removeAttr("value");
    $("#subcategory_"+i).removeAttr("image_file");
    $("#subcategory_"+i).removeAttr("item_type");
  }
}

function showSubCategory(id) {
  idx = 0;
  for (i=0; i<_wardrobeItems.length; i++) {
    if (_wardrobeItems[i].parent_item_id == id) {
      $("#subcategory_"+idx).html(_wardrobeItems[i].name);
      $("#subcategory_"+idx).attr("value", _wardrobeItems[i].id);
      if (_wardrobeItems[i].image_file != undefined) {
        $("#subcategory_"+idx).attr("image_file", _wardrobeItems[i].image_file);
      }
      if (_wardrobeItems[i].item_type != undefined) {
        $("#subcategory_"+idx).attr("item_type", _wardrobeItems[i].item_type);
      }
      idx = idx + 1;
    }
  }
}

function showAvatar() {
  $("#full_name").val(_profile.full_name);
  $("#body").attr("src", "/assets/wardrobe/"+_avatar.body);
  $("#head").attr("src", "/assets/wardrobe/"+_avatar.head);
  $("#bottom").attr("src", "/assets/wardrobe/"+_avatar.bottom);
  $("#top").attr("src", "/assets/wardrobe/"+_avatar.top);
  $("#hair").attr("src", "/assets/wardrobe/"+_avatar.hair);
  $("#shoes").attr("src", "/assets/wardrobe/"+_avatar.shoes);
}

//-->
</script>