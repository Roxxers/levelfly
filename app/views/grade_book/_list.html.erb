<div class="task_side_buttons"> <a href="#" class="big_blue_btn">ATTACH</a> <a href="#" class="big_orange_btn">POST</a> <a href="#" class="big_blue_btn">PRINT</a> </div>
<!-- notepad start-->
  <div class="gradebook_content">
    <div class="gradebook_board_left">
      <div class="gradebook_board_right">
        <div class="gradebook_board_center">
          <div class="gradebook_partribbon">
            <div class="GDingbox" >
              <div class="GDingbox_botright" >
                <div class="GDingbox_botcenter" >
                  <div class="GDingbox_botleft" >
                  <div class="GDingbox_heading" >GRADE PALLETE</div>
                    <div class="GDingbox_botcontainer" >
                      <div class="GDingboxinner_grade" >
                        <div align="center">GRADES</div>
                        <div class="fontsize0px">
                          <input name="" type="button" value="a" class="grading_Btn" />
                          <input name="" type="button" value="b" class="grading_Btn" />
                          <input name="" type="button" value="c" class="grading_Btn" />
                          <input name="" type="button" value="d" class="grading_Btn" />
                          <input name="" type="button" value="f" class="grading_Btn" />
                        </div>
                      </div>
                      <div class="GDingboxinner_plusminus" >
                        <div align="center">&nbsp;</div>
                        <div class="fontsize0px">
                          <input name="" type="image" src="images/grade_plus.png" class="grading_Btn2" />
                          <input name="" src="images/grade_minus.png" type="image"  class="grading_Btn2" />
                        </div>
                      </div>
                      <div class="GDingboxinner_outcome" >
                        <div align="center">OUTCOMES</div>
                        <div class="fontsize0px">
                          <input name="" type="button" value="1" class="grading_Btn Gbtn1" />
                          <input name="" type="button" value="2" class="grading_Btn Gbtn2" />
                          <input name="" type="button" value="3" class="grading_Btn Gbtn3" />
                        </div>
                      </div>
                      <div class="GDingboxinner_latest" >
                        <div align="center">LATEST</div>
                        <div class="fontsize0px">
                          <input name="" src="images/grade_latestbt.png" type="image" class="grading_Btn2" />
                          <input name="" src="images/grade_latestbt.png" type="image" class="grading_Btn2" />
                          <input name="" src="images/grade_latestbt.png" type="image" class="grading_Btn2" />
                        </div>
                      </div>
                      <div class="GDingboxinner_delete" >
                        <div align="center">&nbsp;</div>
                        <div class="fontsize0px">
                          <input name="" src="images/grade_deletebt.png" type="image" class="grading_Btn2" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="gradebook_pad_top"></div>
            <div class="gradebook_pad">
              <!-- tabs-->
              <div class="gradebook_tabs menu_container" align="right">
                 <a href="javascript:void(0)"  id="menu1" value="1" class="side_tab side_tab_open"><span class="task_tab"> Current</span></a>
                 <a href="javascript:void(0)"  id="menu2" value="2" class="side_tab side_tab_close"><span class="task_tab"> Past</span></a>
              </div>
              <!--tab content-->
              <div class="gradebook_tab_content">
               <!-- <div class="spacebar10px"></div>  -->
                <div class="course_select">
                <div class="page_heading">COURSE</div>
                <div class="selectbg"> 
                 <% unless @latest_course.nil? %>
                    <span class="fakebox"><%=@latest_course.name%></span>
                 <% end %>
                 <select id="course_id">
                  <% unless @courses.nil? %>
                    <% @courses.each do |c| %>
                      <option value="<%= c.id %>"><%= c.name %></option>
                    <% end %>
                  <% end %>
                 </select>
                </div>
                </div>
                <div class="clear"></div>
                <div id="all_participant">
                  <%= render :partial=>"/grade_book/show_participant"%>
                </div>
                <div class="clear"></div>
                <div class="extra_height_gradepage"></div>
              </div>
              <div class="clear"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <input type="hidden" name="grade_val"  id ="grad_val" value="">
    <input type="hidden" name="school_id"  id ="school_id" value="<%=@latest_course.school_id if @latest_course%>">
  </div>
<script>

$(document).ready(function(){
  
  setPageTitle("GradeBook");
  var arr = new Array();
  var grades = new Array();
  //Toggle Tabs
  $(".menu_container").delegate('a', 'click', function(){
    //showSpinner(true);
    idx = $(this).attr("value");
    
    $('.side_tab').addClass("side_tab_close").removeClass("side_tab_open");
    
    for(i=0;i<3;i++){
      if(idx != i){
        //$("#div_"+i).hide();
      }
    }
 
    //---- Selected menu will highlighted
    $('#menu'+idx).addClass("side_tab_open").removeClass("side_tab_close");
   // $("#div_"+idx).fadeIn();
    
  });
  
  /*$(".Grade_left_panel").delegate("tr","click",function(){
   idx = $(this).find('input').attr("id");
   arr.push(idx);
   $(this).css("background-color","#b0c4d0");
  });
  */
  $('.grading_Btn').click(function(){
    var val = $(this).val();
    var ids 
    $.each(arr, function(index, id) { 
        $("#"+id).attr("value",val.toUpperCase());
        $("#"+id).css("background-color","");
         //$("#"+ids[1]).attr("value",val.toUpperCase())
      });
    arr = [];
  });
  
  $(".task_right_wp").delegate("input","click",function(){
   id = $(this).attr("id");
   arr.push(id);
   $(this).css("background-color","#DFD4B6");
  });
  
  $(".task_right_wp").delegate("input","change",function(){
    id = $(this).attr("id");
    rel = $(this).attr("rel");
    var course_id = $("#course_id").val();
    var school_id = $("#school_id").val();
    var type = rel.split("_")
    if(type[0]=="p")
    {
      var sum = 0
      var val = 0
      var count = 0
      var ids= id.split("_")
      var participant_id = ids[1];
      var outcome_id = ids[2];
  
      $("input[rel="+rel+"]").each(function(index,item){
        var points = parseInt(item.value)
        if (isNaN(points))
        {
          points=0
        }
        sum = sum + points
        count =index+1
      });
      val = sum/count
      
      $.ajax({
        type :"POST",
        url: "/grade_book/outcomes_points", 
        dataType: "json",
        data: {school_id:school_id,course_id:course_id,outcome_id:outcome_id,participant_id:participant_id,points:val},
        error: function(e){alert("error");},
        success: function(data){
          $("#"+rel).attr("value",data.points) ; 
        }
      });
    }
    else
    {
      $("input[rel="+rel+"]").each(function(index,item){
        grades.push(item.value)
        count =index+1
     });
      var ids= id.split("_")
      var task_id = ids[2];
      var task_grade = $(this).val();
      task_grade = task_grade.toUpperCase();
      var participant_id = rel;
      $.ajax({
        type :"POST",
        url: "/grade_book/grade_calculate", 
        dataType: "json",
        data: {school_id:school_id,characters:grades,course_id:course_id,task_id:task_id,participant_id:participant_id,task_grade:task_grade},
        error: function(e){alert("error");},
        success: function(data){
          $("#"+rel).attr("value",data.grade);
          grades = [];
        }
      });
   }  
   $(this).css("background-color","");
  });
});
$('#course_id').change(function(){
  var singleValues = $("#course_id :selected").text();
  var participant;
  var tasks;
  var outcomes
  course_id = $(this).val();
  $(this).parent().find('.fakebox').html(singleValues );
  $.ajax({
    type :"POST",
    url: "/grade_book/get_task", 
    dataType: "json",
    data: {course_id:course_id},
    success: function(data){
      participant = data.participant;
      outcomes = data.outcomes;
      tasks = data.tasks;
      var option ='';
      var col ='';
      var row =$("<tr></tr>");
      var  table3 = $("<table></table>") 
      $(tasks).each(function(i, value) {
        option = option + "<option value = "+ value.id +">" + value.name +"</option>"
        col= col + "<th>"+value.name+"</th>"
      });
      $('#task_id').html(option);
      row.html(col);
      row.addClass("task_right_heading");
      table3.append(row);
      /*var option_outcomes =''
         $(outcomes).each(function(i, value) {
            option_outcomes = option_outcomes + "<option value = "+ value.id +">" + value.name +"</option>"
         });
         $('#outcome_id').html(option_outcomes)
      */
      var  table = $("<table></table>");
      var  table2 = $("<table></table>");
      table.addClass("GB_left_table GB_table");
      table.css({"width":"100%", "border":"0","cellpadding":"0","cellspacing":"0"});
      table2.addClass("GB_right_table");
      table.attr("id","GB_left_table");
      table2.css({"width":"100%", "border":"0","cellpadding":"0","cellspacing":"0"});
      table3.css({"width":"100%", "border":"0","cellpadding":"0","cellspacing":"0"});
      table3.attr("id","heading_task");
      $(participant).each(function(p, value) {
        var rows =$("<tr></tr>");
        var cols =$("<td></td>");
        var col2 =$("<td></td>");
        var div = $("<div></div>");
        var div2 = $("<div></div>");
        var rows2 =$("<tr></tr>");
        var cols2 =$("<td></td>");
        cols.attr('width','63%');
        var text = '';
        div2.addClass("GB_outcomment rotate_text");
        div2.html("WRITING USING A QUILL");
        div.addClass("b_box");
        col2.css({"width":"37%","align":"center","valign":"middle"});
        cols.addClass("Name_box");
        cols.html(value.full_name);
        cols2.addClass("");
        var  text = $("<input type ='text' value = 'C' id = '"+ value.id +"' maxlength='1' readonly='readonly' size='5'/>")
        text.addClass("task_grade")
        //text.addClass("grades");
        div.html(text);
        col2.html(div);
        rows.html(cols);
        cols2.html(div2);
        $(outcomes).each(function(i, outcomes) {
          var grade_col =$("<td></td>");
          var outcomes_col =$("<td></td>");
          var outcome_name =$("<div></div>"); 
          if(p==0)
          {
            outcome_name.html(outcomes.name);
          }
          outcome_name.addClass("GB_outcomment rotate_text");
          outcomes_col.html(outcome_name);
          var  text = $("<input type ='text' value = '0' id = 'p_"+value.id +"_"+outcomes.id +"' maxlength='1' readonly='readonly' size='1'/>")
          text.addClass("")
          grade_col.html(text);
          grade_col.addClass("td_align")
          rows2.append(outcomes_col);
          rows2.append(grade_col);
        });
        if (p%2==0)
        {
          rows.addClass("GB_odd");
          rows2.addClass("Dark_no");
        }
        else
        {
          rows2.addClass("light_row");
        }
        table2.append(rows2);
        rows.append(col2);
        table.append(rows);
        var row_item = $("<tr></tr>");
        var all_col='';
        $(tasks).each(function(i, task) {
          var rows =$("<tr></tr>");
          var main_col=$("<td></td>");
          var table_task = $("<table></table>");
          var len = task.task_outcomes.length;
         // main_col.css({"border-left":"1px solid white","padding":"0.5px"})
          if(len>0)
          {
            for (i=0; i<len; i++)
            {
              var column =$("<td></td>");
              var point_column =$("<td></td>");
              var outcome =$("<td></td>");
              var outcome_div =$("<div></div>"); 
              var  text_grade = $("<input type ='text' value = 'A' id = 'g_"+value.id+"_"+task.id +"' maxlength='1' size='2' rel = '"+ value.id +"'/>");
              var  text_point = $("<input type ='text' value = '0' id = 'p_"+value.id+"_"+task.task_outcomes[i].id+"_"+task.id +"' rel = 'p_"+value.id+"_"+task.task_outcomes[i].id+"' maxlength='1' size='2'/>");
              text_point.addClass("editable_field task_grade")
              text_grade.addClass("editable_field task_grade")
              column.html(text_grade); 
              column.addClass("td_align")
              
              if(p%2==0)
              {
                outcome.addClass("Dark_no width_30");
                point_column.addClass("Dark_no width_30");
              }
              else
              {
                outcome.addClass("light_row width_30");
                point_column.addClass("light_row width_30");
              }
              if(i==0)
                rows.append(column);
              if(p==0)
              {
                outcome_div.html(task.task_outcomes[i].name);
              }
              outcome_div.addClass("GB_outcomment rotate_text");
              outcome.html(outcome_div);
              point_column.html(text_point);
              point_column.addClass("td_align")
              rows.append(outcome);
              rows.append(point_column);
              }
           }   
         // }
          //column.html("1");
          //rows.append(column);
           if (p%2==0)
            {
              rows.addClass("GB_odd");
            }
          table_task.html(rows);
          main_col.html(table_task);
          row_item.append(main_col);
        });     
        row_item.addClass("GB_row");
        table3.append(row_item);
        table3.addClass("heading_task");
     });
     $('.GB_left_table').replaceWith(table);
     $('.GB_right_table').replaceWith(table2);
     $('.heading_task').replaceWith(table3);
         //$("#GB_left_table").attr("class", "GB_left_table");
     }
  });
});

$('#task_id').change(function(){
  var singleValues = $("#task_id :selected").text();
  $(this).parent().find('.fakebox').html(singleValues );
});

$("#setting_icon").click(function(){
  $("#seting_box").show();
});


/*$(function() {
  $('.editable').inlineEdit();
});*/
</script>



