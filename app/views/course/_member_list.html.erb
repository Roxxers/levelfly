<div id="div_6" class="tab_content">
  <%if (@courseMaster and !@courseMaster.nil?) || (@course and @course.parent_type=="G")%> 
  <div class="titleTextParticipants">Add:&nbsp;&nbsp;
    <span><input type="text" name="add_people_email[]" class="dd_select brown_bg" style="width:300px; padding:2px;" id="add_course_people" placeholder="Enter email..."  /></span>
    <span style="float:right; margin-right:89px;"><a href="javascript:void(0)" name="btn_add_people" id="btn_add_people" class="blue_bt19px btn_add">Invite</a></span>
  </div> 
  <%end%>
  
  <div class="frm_input">
    <div class="frm_input" id="add_people_container"></div>
  </div>
  
  <div class="frm_label small_label">
    &nbsp;
  </div>
  <div class="clear"></div>
  <div id="course_people" class="frm_input" style="width:100%;">
    <% if @peoples %>
      <%= render :partial => "/course/participant_list", :locals => {:peoples=>@peoples, :mode=>"list"} %>
    <% end %>
  </div>
  <div id="course_participant_list" class="hide">
      <div class="participant_close">
        <a href="javascript:void(0)" onClick="javascript:$('#course_participant_list').hide();" class="big_blue_btn">Close</a>
      </div>
      <div id="course_participant_list_inner">
         Loading...
      </div>
  </div>
  <div class="clear"></div>
</div> 
<script type="text/javascript">
//List people (participants)

  $('#add_course_people').bind('keyup', function(e) {
      if ( e.keyCode === 13 ){
          $("#btn_add_people").click();
      }
  });

  $("#btn_add_people").click(function() {
    course_id = $("#course_id_hdn").val();
    section_type = $("#section_type").val(); 
    if($("#hdn_forum_id").val()!="" && $("#hdn_forum_id").val()!= undefined){
        course_id = $("#hdn_forum_id").val();
        section_type = "G"
      }
      else{
         course_id = $("#course_id_hdn").val();
      }
    
    email_id = $("#add_course_people").val();
    node_class = "even";
    dataString = {course_id:course_id, email:email_id,section_type:section_type};
    if (course_id && email_id) {
        showSpinner(true); 
        $.ajax({  
          type: "POST",  
          url: "/course/add_participant",  
          data: dataString,
          dataType: "json",
          success: function(data) {
            if (data.status) {
              participant_node = $('<li id="'+ data.profile.full_name + '" class="msg_big_boxC2 '+node_class+'" style="width:88%; height:88px;"></li>');
              participant_node.className = node_class;
              participant_node.id = data.profile.full_name;
              partcipant_html = '<div class="avatar_white_bdr floatL"><img src='+data.profile.image_file_name+'></div>';
              if(data.new_user){
              partcipant_html += '<div class="people_name" style="width:87%; margin:7px 3px;">' + email_id + '<br />';
              //partcipant_html += '<div style="font-size:10px; font-weight:normal;">' + email_id + '</div>';
              }
              else{
              partcipant_html += '<div class="people_name">' + data.profile.full_name + '<br />';
             // partcipant_html += '<div style="font-size:10px; font-weight:normal;">' + email_id + '</div>';
              }
              partcipant_html += '<span style="font-size:10px; font-weight:normal;">Pending</span></div>';
              partcipant_html += '<div class="clear"></div>';
              participant_node.append(partcipant_html);
              $("#course_people ul").prepend(participant_node);
              $("#course_participant_list").hide();
              $("#hdn_is_page_change").val(true);
            } 
            else {
              if(data.already_added) {
                alert("This participant is already added to this course!!");
              } else {
                alert("No account was found with this email address, An email is sent to "+email_id+" for invitation");
                $("#course_participant_list").hide();
                $("#add_course_people").val("");
              }
            }
            showSpinner(false);
          }
        });
     } else {
      alert("Please insert participant name");
    }
  });
  
  // Delete participant
  $(".people_node").delegate(".people_delete", "click", function(){
    showSpinner(true);
    profile_id = $(this).attr("rel");
    course_id = $("#course_id_hdn").val();
    if($("#hdn_forum_id").val()!="" && $("#hdn_forum_id").val()!= undefined){
        course_id = $("#hdn_forum_id").val();
      }
    else{
         course_id = $("#course_id_hdn").val();
    }
    dataString = {course_id:course_id, profile_id:profile_id};
    if(profile_id) {
      $.ajax({  
        type: "POST",  
        url: "/course/delete_participant",  
        data: dataString,
        success: function(data) {
          if (data) {
            $("#"+profile_id).remove();
          } else {
            alert("ERROR");
          }
          showSpinner(false);
        }
      });
    }
  });
  
   $("#btn_task").click(function(data){
   var course_id=$("#course_id_hdn").val();
   var dataString = {course_id:course_id};
   showSpinner(true);
   $.ajax({  
        type: "GET",  
        url: "/task/view_task",  
        data: dataString,
        success: function(data) {
		      $("#container").html(data);
			    showSpinner(false);
        },
        error: function()
        {
          alert("An Error has occured");
          showSpinner(false);
        },
      }); 
    });
</script>