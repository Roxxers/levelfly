<% if @tasks.nil? %>
  ERROR: Nil @tasks
<% else %>
  <% @tasks.each do |t| %>
    <% participant = t.task_participants[0] %>
    <div class="task_list_content clipboard_list" task_id="<%=t.id%>" style="min-height:100px;">

      <div class="list_hover" style="margin-top:70px; margin-left:150px;">
        <div class="like_cmt">
          <a href="javascript:void(0);" class="tasks_pri_toggle tasks_pri_toggle_btn blue_bt19px" task_id="<%=t.id %>"><% if participant.priority == "H"%>Unstar<%else%>Star<%end%></a>
          <a href="javascript:void(0);" class="tasks_del blue_bt19px" task_id="<%=t.id %>">Remove</a>
        </div>
      </div>
      <div style="float:left; width:150px;">
      <div class="staronavatar2">
        <img src="/images/<% if participant.priority == "H" %>star_up<%else%>star_down<%end%>.png" width="36" height="37" task_id="<%=t.id %>" class="tasks_pri_toggle tasks_pri_toggle_img" />
      </div>

      <div class="titleTcheckboxinner">
        <span class="custom-checkbox_new">
        
        <input type="checkbox" <% if participant.status == "C" %> checked="checked" <% end %> name="task_complete" id="task_complete" class="" rel="<%=t.id%>"/><span class="box"><span class="tick"></span></span> </span>
        </div>

      <div class="avatar_white_bdrC2task">
        <a href="/task/show/<%=t.id%>" id="<%=t.id%>" class="view">
           <img src='<%= t.image_file %>' width="150" height="150" alt="<%=t.name%>" />
        </a>
      </div>
      </div>
      <div style="margin-left:150px;">
      <div class="titleTDue"><%=change_date_format(t.due_date) if t.due_date%></div>
      
      <!-- This column does not expand well. Do we need to control max-width via JavaScript? -->
      <div class="titleTTAsk" >
        <div class="title"><%=long_title(t.name)%></div>
        <div class="description"><p><%=t.descr%></p></div>
      </div>
      
      <!-- From the right -->
      <div class="titleTrating">
      	<span class="font_15px"><%=t.points%></span>
      </div>
      
      <div class="titleTType"><%=t.course.name if t.course %></div>
      </div>

    </div>  <!-- task_list_content -->
    
  <% end %>  <!-- @tasks -->
<% end %>
<!-- Warning pop for remove task -->
<div id="warning_msg_remove" class="add_task_popup" style="display:none;position:fixed;z-index:10000">
	<div class="heading">Remove Task</div>
	<div class="boxadnt"> 
		Warning: By removing this content you will lose all data and files associated with it.
  </div>
	<div class="spacebar10px"></div>
	<div class="spacebar10px"></div>
	<div align="right" style="margin-right:20px;">
		<a class="smaller_text big_blue_btn inlineblock dialog_btn" id="dont_remove_btn" href="javascript:$('#warning_msg_remove').hide();">Don't Remove</a> 
		<a class="big_orange_btn inlineblock dialog_btn" id="remove_task_cnfrm" href="javascript:void(0)">Remove</a>
	</div>
</div>
<!-- Warning pop for grading category select ends -->
<script type="text/javascript">
	var remove_task_id;
	$(document).ready(function() {
    $(".description").dotdotdot({
	        //  configuration goes here
	    });
	});
  //setPageTitle("My Tasks");
  $('a.view').click(function() {
    showSpinner(true);
    $("#container").load(this.href, function(){
      task_id = $(this).attr("id");
      $("#menu_btn_dup").attr("data","id="+task_id);
      $("#menu_btn_dup").show();
      showSpinner(false);
    });
    return false; 
  });
  jStorage.flush();
  
 $('input[type="checkbox"]').unbind('click').bind('click',function(event) {
    check_val = $(this).is(':checked');
    showSpinner(true);
    task_id = $(this).attr("rel");
    $.ajax({
       type:"POST",
       url:"/task/task_complete",
       data:{task_id:task_id,check_val:check_val},
       dataType:"json",
       success:function(data){
         showSpinner(false);
         if (data.status) {
           setAlert("Task completed")
           $(".clipboard_list[task_id="+task_id+"]").css("background-color", "#BCD599");
         } else {
           setAlert("Task not completed")
           $(".clipboard_list[task_id="+task_id+"]").css("background-color", "");
         }
       }
    });
    event.stopPropagation();
  });
   
  $(".task_list_content").hover(
    function () {
      $(".list_hover", this).show();
    }, 
    function () {
      $(".list_hover", this).hide();
    }
  );
  
  $(".task_list_content").click(function() {
    var task_id = $(this).attr("task_id")
    setAlert("Show task " + task_id);
    load_data("/task/show/"+task_id, null);
  });

  $(".tasks_pri_toggle").click(function(event){
    showSpinner(true);
    task_id = $(this).attr("task_id");
    $.ajax({
       type: "POST",  
       url: "/task/toggle_priority",  
       data: {task_id:task_id},
       dataType: "json",
       success: function(data) {
         if (data.status){
           if (data.priority == "H") {
             $(".tasks_pri_toggle_btn[task_id="+task_id+"]").html("Unstar");
             $(".tasks_pri_toggle_img[task_id="+task_id+"]").attr("src", "/images/star_up.png");
           } else {
             $(".tasks_pri_toggle_btn[task_id="+task_id+"]").html("Star");
             $(".tasks_pri_toggle_img[task_id="+task_id+"]").attr("src", "/images/star_down.png");
           }
         }
         showSpinner(false);
       }
    });
    event.stopPropagation();
  });  
  
	// Remove task confirmation
  $(".tasks_del").click(function(event){
		remove_task_id = $(this).attr("task_id");
		$("#warning_msg_remove").show();
    event.stopPropagation();
  });  
	
	// Remove task
	$("#remove_task_cnfrm").click(function(){
		$("#warning_msg_remove").hide();
		showSpinner(true);
		$.ajax({
       type: "POST",  
       url: "/task/remove_tasks",  
       data: {task_id:remove_task_id},
       dataType: "json",
       success: function(data) {
				 if(data.status){
           $(".task_list_content[task_id="+remove_task_id+"]").fadeOut();
         }
				 remove_task_id = '';
         showSpinner(false);
       }
    });
	});
	
  
  // For task priority
  $("#XXXstaronavatar2 a").unbind("click").bind("click",function(){
    showSpinner(true);  
    priority = $(this).attr("rel");
    task_id = $(this).attr("id");
    $.ajax({
      type:"POST",
      url:"/task/check_priorities",
      data:{priority:priority,task_id:task_id},
      success:function(data){
        if(data.status)
          showSpinner(false);
        else  
          showSpinner(true);
      },
      error:function(){
        alert("Error");
        showSpinner(false);
      }
    });
  });
      
</script>
